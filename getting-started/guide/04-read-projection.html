<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building a Read Projection | Cosmos Event Sourcing</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Make use of Cosmos DB as an event store">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/cosmos-event-sourcing-docs/assets/css/0.styles.c3244ff2.css" as="style"><link rel="preload" href="/cosmos-event-sourcing-docs/assets/js/app.c889ef55.js" as="script"><link rel="preload" href="/cosmos-event-sourcing-docs/assets/js/2.e3883e0f.js" as="script"><link rel="preload" href="/cosmos-event-sourcing-docs/assets/js/18.662d8444.js" as="script"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/10.dc2e3a6d.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/11.85dbee3e.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/12.e32a73b6.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/13.f5b9886e.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/14.d64601fd.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/15.3459d247.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/16.13e5ca33.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/17.4ad77b05.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/19.3fcca83d.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/20.e48b2a4a.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/21.1f1e0cdf.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/22.9013fb91.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/23.27cd1266.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/3.32b655d3.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/4.e27a7f7a.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/5.e9f4081f.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/7.81b258a5.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/8.fc67d087.js"><link rel="prefetch" href="/cosmos-event-sourcing-docs/assets/js/9.effed064.js">
    <link rel="stylesheet" href="/cosmos-event-sourcing-docs/assets/css/0.styles.c3244ff2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cosmos-event-sourcing-docs/" class="home-link router-link-active"><img src="/cosmos-event-sourcing-docs/small-logo.jpg" alt="Cosmos Event Sourcing" class="logo"> <span class="site-name can-hide">Cosmos Event Sourcing</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cosmos-event-sourcing-docs/getting-started/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/cosmos-event-sourcing-docs/samples/" class="nav-link">
  Samples
</a></div><div class="nav-item"><a href="https://discord.com/invite/qMXrX4shAv" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/IEvangelist/azure-cosmos-dotnet-repository" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cosmos-event-sourcing-docs/getting-started/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/cosmos-event-sourcing-docs/samples/" class="nav-link">
  Samples
</a></div><div class="nav-item"><a href="https://discord.com/invite/qMXrX4shAv" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/IEvangelist/azure-cosmos-dotnet-repository" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/cosmos-event-sourcing-docs/getting-started/" class="sidebar-heading clickable router-link-active open"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/cosmos-event-sourcing-docs/getting-started/" aria-current="page" class="sidebar-link">Overview</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/cosmos-event-sourcing-docs/getting-started/guide/00-overview/" class="sidebar-heading clickable open"><span>Guide</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/cosmos-event-sourcing-docs/getting-started/guide/01-domain-implementation.html" class="sidebar-link">Domain Implementation</a></li><li><a href="/cosmos-event-sourcing-docs/getting-started/guide/02-store-config.html" class="sidebar-link">Configuring a Store</a></li><li><a href="/cosmos-event-sourcing-docs/getting-started/guide/03-replaying-events.html" class="sidebar-link">Replaying Events</a></li><li><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html" aria-current="page" class="active sidebar-link">Building a Read Projection</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html#defining-a-read-model" class="sidebar-link">Defining a Read Model</a></li><li class="sidebar-sub-header"><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html#configuring-storage" class="sidebar-link">Configuring Storage</a></li><li class="sidebar-sub-header"><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html#building-the-read-model" class="sidebar-link">Building the Read Model</a></li><li class="sidebar-sub-header"><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html#configuring-projection" class="sidebar-link">Configuring Projection</a></li><li class="sidebar-sub-header"><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html#configure-a-background-service" class="sidebar-link">Configure a Background Service</a></li><li class="sidebar-sub-header"><a href="/cosmos-event-sourcing-docs/getting-started/guide/04-read-projection.html#try-it-out" class="sidebar-link">Try it out!</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/cosmos-event-sourcing-docs/event-store/" class="sidebar-heading clickable"><span>Event Store</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/cosmos-event-sourcing-docs/event-store/persistence/" class="sidebar-link">Persistence</a></li><li><a href="/cosmos-event-sourcing-docs/event-store/reading/" class="sidebar-link">Reading</a></li></ul></section></li><li><a href="/cosmos-event-sourcing-docs/projections/" class="sidebar-link">Projections</a></li><li><a href="/cosmos-event-sourcing-docs/learning/" class="sidebar-link">Learning Resources</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="building-a-read-projection"><a href="#building-a-read-projection" class="header-anchor">#</a> Building a Read Projection</h1> <p>The library also supports building projections which are done out of process and make use of Azure Cosmos DBs change feed. For more information on how the change feed works and how this library utilizes it see the <a href="/cosmos-event-sourcing-docs/projections/">projections documentation here.</a></p> <p>A read projection in this example is going to store a single document that represents current state. The reason for this is that let's say we expand on our <code>CustomerAccount</code> example and we add more and more events. This is great and totally the idea of event sourcing, however, if we needed to serve the current state of a customer's account quickly via an API call for example. Then replaying these events to build up current state might not be the most efficient way to do this.</p> <p>This is where a read projection comes into play, every time a new event is added we can process this and apply it to our read only projection. This can then be read with a single read to cosmos and we immediately have current state.</p> <div class="custom-block tip"><p class="custom-block-title">Tip</p> <p>There is a fantastic video on projections by Derek Comartin this can be found on his <a href="https://www.youtube.com/watch?v=bTRjO6JK4Ws" target="_blank" rel="noopener noreferrer">YouTube channel CodeOpinion here.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h2 id="defining-a-read-model"><a href="#defining-a-read-model" class="header-anchor">#</a> Defining a Read Model</h2> <p>The library makes use of the <a href="https://ievangelist.github.io/azure-cosmos-dotnet-repository/" target="_blank" rel="noopener noreferrer"><code>IEvangelist.Azure.CosmosRepository</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to store it's event, this means you can also use this package to store your read projections or any other data that you want!</p> <p>The first step is to define a class that will represent our <code>CustomerAccount</code> read model. This is defined below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">EventSourcingCustomerAccount<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>CosmosRepository</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">EventSourcingCustomerAccount<span class="token punctuation">.</span>Items</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerAccountReadItem</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">FullItem</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Surname <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">CustomerAddress<span class="token punctuation">?</span></span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetPartitionKeyValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        Username<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CustomerAccountReadItem</span><span class="token punctuation">(</span>
        <span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">,</span> 
        <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span> 
        <span class="token class-name"><span class="token keyword">string</span></span> firstName<span class="token punctuation">,</span> 
        <span class="token class-name"><span class="token keyword">string</span></span> surname<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Id <span class="token operator">=</span> username<span class="token punctuation">;</span>
        Username <span class="token operator">=</span> username<span class="token punctuation">;</span>
        Email <span class="token operator">=</span> email<span class="token punctuation">;</span>
        FirstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
        Surname <span class="token operator">=</span> surname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is a simple POCO class that will be serialized to and from JSON by the library and stored in a container. <a href="https://github.com/IEvangelist/azure-cosmos-dotnet-repository#optimistic-concurrency-control-with-etags" target="_blank" rel="noopener noreferrer">This make use of a <code>FullItem</code> base <code>class</code> read more on this here.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="custom-block-title">Tip</p> <p>You do not have to use Azure Cosmos DB to store your models you build via projections you can use whatever you like!</p></div> <h2 id="configuring-storage"><a href="#configuring-storage" class="header-anchor">#</a> Configuring Storage</h2> <p>The next step is to configure somewhere for this projection to be stored. To do this we can use an extension method provided by the library. We simply need to extend our <code>.AddCosmosEventSourcing(...)</code> implementation.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddCosmosEventSourcing</span><span class="token punctuation">(</span>eventSourcingBuilder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    eventSourcingBuilder<span class="token punctuation">.</span><span class="token function">AddCosmosRepository</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>DatabaseId <span class="token operator">=</span> <span class="token string">&quot;customer-accounts-sample-db&quot;</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>ContainerBuilder
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConfigureEventItemStore</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomerAccountEventItem<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
                <span class="token string">&quot;customer-account-events&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConfigureProjectionStore</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomerAccountReadItem<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">containerName</span><span class="token punctuation">:</span> <span class="token string">&quot;projections&quot;</span><span class="token punctuation">,</span> 
                <span class="token named-parameter punctuation">partitionKey</span><span class="token punctuation">:</span> <span class="token string">&quot;/username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    eventSourcingBuilder<span class="token punctuation">.</span><span class="token function">AddDomainEventTypes</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above example we are saying use a new container called <code>projections</code> and we are saying these projections will be partitioned by <code>/username</code>.</p> <h2 id="building-the-read-model"><a href="#building-the-read-model" class="header-anchor">#</a> Building the Read Model</h2> <p>In order to build a projection the first step is to implement the interface<code>IEventItemProjection&lt;TEventItem, TProjectionKey&gt;</code>. Once you have this you get the opportunity to process the events that you want. This follows a similar pattern to the <code>Apply(...)</code> methods used in the domain implementation. However, here we can only process the events that we care about for our current projection. See the example projection below.</p> <blockquote><p>The TProjectionKey is used to allow multiple projections on the same host.</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Copyright (c) IEvangelist. All rights reserved.</span>
<span class="token comment">// Licensed under the MIT License.</span>

<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">ReadProjectionKey</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IProjectionKey</span></span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">EventSourcingCustomerAccount<span class="token punctuation">.</span>Events</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">EventSourcingCustomerAccount<span class="token punctuation">.</span>Items</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">EventSourcingCustomerAccount<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>CosmosEventSourcing<span class="token punctuation">.</span>Projections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>CosmosRepository</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">EventSourcingCustomerAccount<span class="token punctuation">.</span>Projections</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerAccountReadProjection</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">IEventItemProjection<span class="token punctuation">&lt;</span>CustomerAccountEventItem<span class="token punctuation">,</span> ReadProjectionKey<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>CustomerAccountReadItem<span class="token punctuation">&gt;</span></span> _repository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CustomerAccountReadProjection</span><span class="token punctuation">(</span>
        <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>CustomerAccountReadItem<span class="token punctuation">&gt;</span></span> repository<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        _repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">ValueTask</span> <span class="token function">ProjectAsync</span><span class="token punctuation">(</span>
        <span class="token class-name">CustomerAccountEventItem</span> sourcedEvent<span class="token punctuation">,</span>
        <span class="token class-name">CancellationToken</span> cancellationToken <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>sourcedEvent<span class="token punctuation">.</span>DomainEvent<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token class-name">CustomerAccountCreated</span> created<span class="token punctuation">:</span>
                <span class="token keyword">await</span> <span class="token function">CreateProjection</span><span class="token punctuation">(</span>created<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token class-name">CustomerAccountAddressAssigned</span> addressAssigned<span class="token punctuation">:</span>
                <span class="token keyword">await</span> <span class="token function">AssignAddressToProjection</span><span class="token punctuation">(</span>addressAssigned<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">CreateProjection</span><span class="token punctuation">(</span>
        <span class="token class-name">CustomerAccountCreated</span> created<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">CustomerAccountReadItem</span> readProjection <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span>
            created<span class="token punctuation">.</span>Username<span class="token punctuation">,</span>
            created<span class="token punctuation">.</span>Email<span class="token punctuation">,</span>
            created<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span>
            created<span class="token punctuation">.</span>Surname<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> _repository<span class="token punctuation">.</span><span class="token function">CreateAsync</span><span class="token punctuation">(</span>readProjection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">AssignAddressToProjection</span><span class="token punctuation">(</span>
        <span class="token class-name">CustomerAccountAddressAssigned</span> addressAssigned<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">CustomerAccountReadItem</span> readProjection <span class="token operator">=</span>
            <span class="token keyword">await</span> _repository<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>addressAssigned<span class="token punctuation">.</span>Username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        readProjection<span class="token punctuation">.</span>Address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomerAddress</span><span class="token punctuation">(</span>
            addressAssigned<span class="token punctuation">.</span>AddressLine1<span class="token punctuation">,</span>
            addressAssigned<span class="token punctuation">.</span>AddressLine2<span class="token punctuation">,</span>
            addressAssigned<span class="token punctuation">.</span>City<span class="token punctuation">,</span>
            addressAssigned<span class="token punctuation">.</span>Country<span class="token punctuation">,</span>
            addressAssigned<span class="token punctuation">.</span>PostCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> _repository<span class="token punctuation">.</span><span class="token function">UpdateAsync</span><span class="token punctuation">(</span>readProjection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="configuring-projection"><a href="#configuring-projection" class="header-anchor">#</a> Configuring Projection</h2> <p>Now we have our <code>IEventItemProjection&lt;CustomerAccountEventItem, ReadProjectionKey&gt;</code> we need to tell the library to use it. This is done via again extending the <code>.AddCosmosEventSourcing(...)</code> implementation. See an example of this below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddCosmosEventSourcing</span><span class="token punctuation">(</span>eventSourcingBuilder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Excluded for brevity</span>

    eventSourcingBuilder
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddEventItemProjection</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomerAccountEventItem<span class="token punctuation">,</span>
            ReadProjectionKey<span class="token punctuation">,</span>
            CustomerAccountReadProjection<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
            options <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span>ProcessorName <span class="token operator">=</span>
                    <span class="token string">&quot;customer-account-read-projection-builder&quot;</span><span class="token punctuation">;</span>

                options<span class="token punctuation">.</span>InstanceName <span class="token operator">=</span>
                    Environment<span class="token punctuation">.</span>MachineName<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    eventSourcingBuilder<span class="token punctuation">.</span><span class="token function">AddDomainEventTypes</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The above example uses the <code>AddEventItemProjection&lt;TEventItem, TProjectionKey, TProjection&gt;(...)</code> method. Your first specify the <code>EventItem</code> type you are going to process and second the builder that will process the events.</p> <p>You then specify a processor name, this is the description of the processors intent. The next is the instance name, this is the physical processor. This is used when load balancing changes across multiple nodes. You can read more on how the <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/sql/change-feed-processor" target="_blank" rel="noopener noreferrer">Azure Cosmos DBs change feed processor library uses this here.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="configure-a-background-service"><a href="#configure-a-background-service" class="header-anchor">#</a> Configure a Background Service</h2> <p>Once you have this configured we need to make use another library which provides an implementation of a <code>BackgroundService</code> which will listen to changes from the change feed on a background process.</p> <p>First install the <a href="https://www.nuget.org/packages/IEvangelist.Azure.CosmosRepository.AspNetCore/" target="_blank" rel="noopener noreferrer"><code>IEvangelist.Azure.CosmosRepository.AspNetCore</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> package to the project.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> MyEventSourcingApplication
$ dotnet <span class="token function">add</span> package IEvangelist.Azure.CosmosRepository.AspNetCore
</code></pre></div><p>Then we can use the extension method provided to run the background process to listen to changes.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">WebApplicationBuilder</span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Excluded for brevity</span>

builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddCosmosEventSourcing</span><span class="token punctuation">(</span>eventSourcingBuilder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Excluded for brevity</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddCosmosRepositoryChangeFeedHostedService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">WebApplication</span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="try-it-out"><a href="#try-it-out" class="header-anchor">#</a> Try it out!</h2> <p>The next step is to run the application, create an account and then assign it an address via the API endpoints setup earlier. Then check the <code>projections</code> container for the newly built projection!</p> <p>See an example projection below</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321@domain.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Fred&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;surname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Jones&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;addressLine1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;100 Street 10&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;addressLine2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Town A&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;London&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;country&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UK&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;postCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LS1 7YH&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_etag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\&quot;04004c95-0000-0d00-0000-622dd78a0000\&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timeToLive&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;createdTimeUtc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-03-13T11:35:36.737351Z&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountReadItem&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_rid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gq1NAPDGLZQBAAAAAAAAAA==&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_self&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbs/Gq1NAA==/colls/Gq1NAPDGLZQ=/docs/Gq1NAPDGLZQBAAAAAAAAAA==/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_attachments&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attachments/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_ts&quot;</span><span class="token operator">:</span> <span class="token number">1647171466</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The corresponding events that created this projection are also shown below. The query used to pull these back in the azure portal is also shown.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- Run against the customer-account-events container</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> c
<span class="token keyword">where</span> c<span class="token punctuation">.</span>partitionKey <span class="token operator">=</span> <span class="token string">'user321'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">.</span>eventPayload<span class="token punctuation">[</span><span class="token string">&quot;sequence&quot;</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;eventPayload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321@domain.com&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Fred&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;surname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Jones&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountCreated&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sequence&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;occuredUtc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-03-13T11:35:28.437917Z&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;partitionKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountCreated&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_etag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\&quot;0b002785-0000-0d00-0000-622dd7010000\&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;timeToLive&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;createdTimeUtc&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;7205f507-877e-498e-a405-ad0324ec1dc1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountEventItem&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_rid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gq1NAIsdmJwEAAAAAAAAAA==&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_self&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbs/Gq1NAA==/colls/Gq1NAIsdmJw=/docs/Gq1NAIsdmJwEAAAAAAAAAA==/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_attachments&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attachments/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_ts&quot;</span><span class="token operator">:</span> <span class="token number">1647171329</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;eventPayload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;addressLine1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;100 Street 10&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;addressLine2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Town A&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;London&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;country&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UK&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;postCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LS1 7YH&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountAddressAssigned&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sequence&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">&quot;occuredUtc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-03-13T11:37:42.093858Z&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;partitionKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountAddressAssigned&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_etag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\&quot;0b002f86-0000-0d00-0000-622dd7860000\&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;timeToLive&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;createdTimeUtc&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;84864304-ad96-4a0a-9832-1c8a56e9ad46&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountEventItem&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_rid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gq1NAIsdmJwGAAAAAAAAAA==&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_self&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbs/Gq1NAA==/colls/Gq1NAIsdmJw=/docs/Gq1NAIsdmJwGAAAAAAAAAA==/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_attachments&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attachments/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_ts&quot;</span><span class="token operator">:</span> <span class="token number">1647171462</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;eventPayload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AtomicEvent&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sequence&quot;</span><span class="token operator">:</span> <span class="token number">2147483647</span><span class="token punctuation">,</span>
            <span class="token property">&quot;occuredUtc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2022-03-13T11:37:42.093597Z&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;partitionKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user321&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;eventName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AtomicEvent&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_etag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\&quot;0b003086-0000-0d00-0000-622dd7860000\&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;timeToLive&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;createdTimeUtc&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5189e4f0-d4c2-47e3-9b53-3a73c8c25587&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CustomerAccountEventItem&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_rid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Gq1NAIsdmJwFAAAAAAAAAA==&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_self&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dbs/Gq1NAA==/colls/Gq1NAIsdmJw=/docs/Gq1NAIsdmJwFAAAAAAAAAA==/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_attachments&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attachments/&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_ts&quot;</span><span class="token operator">:</span> <span class="token number">1647171462</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/IEvangelist/azure-cosmos-dotnet-repository/edit/master/getting-started/guide/04-read-projection.md" target="_blank" rel="noopener noreferrer">Contribute to this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/3/2023, 3:01:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/cosmos-event-sourcing-docs/getting-started/guide/03-replaying-events.html" class="prev">
        Replaying Events
      </a></span> <span class="next"><a href="/cosmos-event-sourcing-docs/event-store/persistence/">
        Persistence
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/cosmos-event-sourcing-docs/assets/js/app.c889ef55.js" defer></script><script src="/cosmos-event-sourcing-docs/assets/js/2.e3883e0f.js" defer></script><script src="/cosmos-event-sourcing-docs/assets/js/18.662d8444.js" defer></script>
  </body>
</html>
